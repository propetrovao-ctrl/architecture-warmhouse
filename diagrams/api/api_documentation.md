# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - –°–∏—Å—Ç–µ–º–∞ —É–º–Ω–æ–≥–æ –¥–æ–º–∞

–≠—Ç–æ –º–æ—è —É—á–µ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã —É–º–Ω–æ–≥–æ –¥–æ–º–∞. –ó–¥–µ—Å—å —è –∏–∑—É—á–∞—é, –∫–∞–∫ —Å–µ—Ä–≤–∏—Å—ã –æ–±—â–∞—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º.

## –ß—Ç–æ —Ç–∞–∫–æ–µ API?

**API** (Application Programming Interface) - —ç—Ç–æ —Å–ø–æ—Å–æ–±, –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—â–∞—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —ç—Ç–æ –∫–∞–∫ –º–µ–Ω—é –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ - –≤—ã –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç–µ –±–ª—é–¥–æ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∑–∞–ø—Ä–æ—Å), –∞ –ø–æ–≤–∞—Ä –≥–æ—Ç–æ–≤–∏—Ç –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç –µ–≥–æ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç).

## –¢–∏–ø—ã API –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

### 1. REST API (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ)
–ö–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –¥—Ä—É–≥–æ–≥–æ: "–î–∞–π –º–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ" –∏ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞.

### 2. AsyncAPI (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ)  
–ö–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –≥–æ–≤–æ—Ä–∏—Ç: "–£ –º–µ–Ω—è –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ" –∏ –Ω–µ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞. –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–ª—É—á–∞—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∂–µ.

## API –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### 1. –°–µ—Ä–≤–∏—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Device Service)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–ø—Ä–∞–≤–ª—è–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –≤ –¥–æ–º–µ

#### –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
```
GET /api/v1/devices/{deviceId}
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ URL
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
GET /api/v1/devices/123
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "id": 123,
  "name": "–î–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ –≥–æ—Å—Ç–∏–Ω–æ–π",
  "type": "temperature_sensor",
  "house_id": 456,
  "location": "–ì–æ—Å—Ç–∏–Ω–∞—è",
  "status": "active",
  "created_at": "2024-01-15T10:30:00Z"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `200` - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–æ
- `404` - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- `500` - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

#### –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```
PUT /api/v1/devices/{deviceId}/status
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
PUT /api/v1/devices/123/status
Content-Type: application/json

{
  "status": "inactive",
  "reason": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ"
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "message": "–°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω",
  "device_id": 123,
  "new_status": "inactive"
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `200` - –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `404` - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

### 2. –°–µ—Ä–≤–∏—Å –¥–∞–Ω–Ω—ã—Ö (Telemetry Service)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤

#### –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
```
GET /api/v1/telemetry/devices/{deviceId}/history
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
GET /api/v1/telemetry/devices/123/history?from=2024-01-01&to=2024-01-31&type=temperature
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "device_id": 123,
  "property_type": "temperature",
  "data": [
    {
      "timestamp": "2024-01-15T10:00:00Z",
      "value": 22.5,
      "unit": "¬∞C"
    },
    {
      "timestamp": "2024-01-15T11:00:00Z", 
      "value": 23.1,
      "unit": "¬∞C"
    }
  ],
  "total_records": 2
}
```

**–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:**
- `200` - –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- `404` - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

#### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```
POST /api/v1/telemetry/alerts
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
POST /api/v1/telemetry/alerts
Content-Type: application/json

{
  "device_id": 123,
  "property_type": "temperature",
  "threshold": 25.0,
  "condition": "greater_than",
  "notification_method": "email",
  "user_id": 789
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "alert_id": 456,
  "message": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ",
  "device_id": 123,
  "threshold": 25.0
}
```

### 3. –°–µ—Ä–≤–∏—Å –¥–æ–º–æ–≤ (House Service)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ–º–∞–º–∏ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

#### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –¥–æ–º–µ
```
GET /api/v1/houses/{houseId}/devices
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** ID –¥–æ–º–∞
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –¥–æ–º–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
GET /api/v1/houses/456/devices
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "house_id": 456,
  "house_name": "–ú–æ–π —É–º–Ω—ã–π –¥–æ–º",
  "devices": [
    {
      "id": 123,
      "name": "–î–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –≤ –≥–æ—Å—Ç–∏–Ω–æ–π",
      "type": "temperature_sensor",
      "location": "–ì–æ—Å—Ç–∏–Ω–∞—è",
      "status": "active"
    },
    {
      "id": 124,
      "name": "–î–∞—Ç—á–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –≤ —Å–ø–∞–ª—å–Ω–µ",
      "type": "humidity_sensor", 
      "location": "–°–ø–∞–ª—å–Ω—è",
      "status": "active"
    }
  ],
  "total_devices": 2
}
```

### 4. –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Auth Service)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST /api/v1/auth/validate
```

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º:** –¢–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ–º:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
POST /api/v1/auth/validate
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "valid": true,
  "user_id": 789,
  "username": "ivan_petrov",
  "email": "ivan@example.com",
  "houses": [456, 457],
  "expires_at": "2024-01-16T10:30:00Z"
}
```

## –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ (AsyncAPI)

### –°–æ–±—ã—Ç–∏—è –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤

–ö–æ–≥–¥–∞ –¥–∞—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–µ—Ä–≤–∏—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ:

**–¢–æ–ø–∏–∫:** `device.telemetry.new`

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```json
{
  "event_id": "evt_123456",
  "device_id": 123,
  "property_type": "temperature",
  "value": 22.5,
  "unit": "¬∞C",
  "timestamp": "2024-01-15T10:30:00Z",
  "location": "–ì–æ—Å—Ç–∏–Ω–∞—è"
}
```

### –°–æ–±—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ö–æ–≥–¥–∞ –ø—Ä–µ–≤—ã—à–µ–Ω –ø–æ—Ä–æ–≥, —Å–µ—Ä–≤–∏—Å –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

**–¢–æ–ø–∏–∫:** `alerts.threshold.exceeded`

**–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:**
```json
{
  "alert_id": 456,
  "device_id": 123,
  "user_id": 789,
  "property_type": "temperature",
  "threshold": 25.0,
  "current_value": 26.2,
  "severity": "warning",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## –ß—Ç–æ —è –∏–∑—É—á–∏–ª

### REST API:
- **GET** - –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- **POST** - —Å–æ–∑–¥–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ
- **PUT** - –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
- **DELETE** - —É–¥–∞–ª–∏—Ç—å

### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤:
- **200** - –≤—Å–µ —Ö–æ—Ä–æ—à–æ
- **400** - –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **404** - –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- **500** - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö:
- **JSON** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏
- **HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∏—Å–∫–∞

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ:
- **–°–æ–±—ã—Ç–∏—è** - –∫–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- **–¢–æ–ø–∏–∫–∏** - –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è
- **–ü–æ–¥–ø–∏—Å—á–∏–∫–∏** - –∫—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ –∫–∞–∫ –æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è —Å–∏—Å—Ç–µ–º–∞! üè†‚ú®



